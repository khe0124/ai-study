# 보안 개선 사항

이 문서는 백엔드 API의 보안 개선 사항을 설명합니다.

## 주요 보안 개선 사항

### 1. Rate Limiting (요청 제한)

무차별 대입 공격(Brute Force Attack)을 방지하기 위해 요청 제한을 구현했습니다.

- **일반 API**: 15분당 최대 100회 요청
- **로그인**: 15분당 최대 5회 시도 (성공한 요청은 제외)
- **회원가입**: 1시간당 최대 3회 시도
- **소셜 로그인**: 15분당 최대 10회 시도
- **속도 제한**: 50회 요청 후부터 점진적 지연 (최대 20초)

### 2. 보안 헤더 (Helmet)

Helmet 미들웨어를 통해 보안 헤더를 자동으로 설정합니다:

- `X-Content-Type-Options: nosniff`
- `X-Frame-Options: DENY`
- `X-XSS-Protection: 1; mode=block`
- `Strict-Transport-Security` (HTTPS 사용 시)
- 기타 보안 헤더

### 3. 입력 검증 강화

- **이메일**: 최대 254자 (RFC 5321 표준), 소문자 정규화
- **비밀번호**: 8-128자, 대문자/소문자/숫자/특수문자 필수
- **토큰**: 최대 2000자 제한
- **Body 크기**: 최대 10MB 제한

### 4. Timing Attack 방어

로그인 시 사용자 존재 여부를 알 수 없도록 일관된 응답 시간을 보장합니다:

- 존재하지 않는 사용자도 더미 해시로 비밀번호 검증 수행
- 최소 100ms 응답 시간 보장
- 일관된 에러 메시지 반환

### 5. 비밀번호 보안 강화

- **bcrypt rounds**: 10 → 12로 증가 (더 강력한 해싱)
- **특수문자 필수**: `@$!%*?&` 중 하나 이상 포함
- **최대 길이 제한**: 128자

### 6. JWT 토큰 보안

- **Issuer/Audience 검증**: 토큰 발급자와 대상 검증
- **환경 변수 검증**: JWT_SECRET이 설정되지 않으면 서버 시작 실패
- **기본값 제거**: 프로덕션에서 기본 JWT_SECRET 사용 시 에러

### 7. 에러 메시지 개선

프로덕션 환경에서 정보 노출을 최소화합니다:

- 상세한 에러 메시지 숨김
- 스택 트레이스 숨김
- 일관된 에러 응답 형식

### 8. CORS 보안

- 허용된 Origin만 접근 가능
- 개발 환경에서만 유연한 설정
- Credentials 지원

### 9. 소셜 로그인 보안

- **토큰 길이 검증**: 최대 2000자 제한
- **타임아웃 설정**: 외부 API 호출 시 10초 타임아웃
- **에러 처리 개선**: 401 에러 시 명확한 메시지
- **Apple 토큰**: 형식 검증 강화

### 10. 환경 변수 검증

서버 시작 시 필수 환경 변수를 검증합니다:

- `JWT_SECRET` 필수
- 기본값 사용 시 경고/에러
- 프로덕션 환경에서 누락 시 서버 종료

## 보안 체크리스트

### 프로덕션 배포 전 확인 사항

- [ ] `JWT_SECRET`이 강력한 랜덤 문자열로 설정되었는가? (최소 32자)
- [ ] 기본 JWT_SECRET이 아닌가?
- [ ] HTTPS가 활성화되어 있는가?
- [ ] CORS 설정이 올바른가?
- [ ] 환경 변수가 모두 설정되었는가?
- [ ] Rate Limiting 설정이 적절한가?
- [ ] 에러 로깅이 적절히 설정되었는가?

## 추가 권장 사항

### 1. 데이터베이스 보안

현재는 인메모리 데이터베이스를 사용하지만, 실제 DB 사용 시:

- Prepared Statements 사용 (SQL Injection 방지)
- 연결 암호화 (SSL/TLS)
- 최소 권한 원칙 적용
- 정기적인 백업

### 2. 로깅 및 모니터링

- 인증 실패 로그 기록
- 의심스러운 활동 모니터링
- Rate Limiting 위반 알림

### 3. 세션 관리

- Refresh Token 구현 고려
- 토큰 만료 시간 조정
- 토큰 무효화 메커니즘

### 4. Apple 인증 개선

현재는 토큰 디코딩만 수행하지만, 프로덕션에서는:

- Apple 공개키로 서명 검증
- 토큰 발급 시간 검증
- Audience 검증

### 5. 추가 보안 기능

- 2FA (Two-Factor Authentication)
- 계정 잠금 기능
- 비밀번호 재설정 토큰
- 이메일 인증

## 보안 취약점 보고

보안 취약점을 발견하셨다면, 즉시 프로젝트 관리자에게 알려주세요.
